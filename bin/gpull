#!/bin/bash

run_command() {
  if test -d $1 && cd $1
  then
    if [ -d '.git' ]
    then
      M='Pulling'
      echo ${M-''} `pwd` `git branch 2>/dev/null | grep -e '^*' | sed -E 's/^\* (.+)$/(\1) /'`
      git fetch && git pull origin $(git rev-parse --symbolic-full-name --abbrev-ref HEAD)
      cd - 1>/dev/null
    else
      cd - 1>/dev/null
      false
    fi
  else
    false
  fi
}

while getopts ':a' opt; do
  case $opt in
    a)
      shift
      cd ${1-'.'}
      for entry in *; do
        run_command $PWD'/'$entry # no pause
      done
      exit 0
      ;;
  esac
done

run_command ${1-'.'}